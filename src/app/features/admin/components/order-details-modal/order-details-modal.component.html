<div
   class="fixed inset-0 z-50 flex items-center justify-center px-4 py-6 sm:p-6"
   tabindex="0"
   (keydown.escape)="modalClose.emit()"
>
   <div
      class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity animate-fade-in"
      (click)="modalClose.emit()"
      (keyup)="modalClose.emit()"
      tabindex="0"
   ></div>

   <div
      class="relative w-full max-w-4xl max-h-[90vh] flex flex-col bg-white rounded-2xl shadow-2xl overflow-hidden animate-zoom-in"
   >
      <div
         class="px-6 py-4 border-b border-gray-100 bg-gray-50 flex justify-between items-center shrink-0"
      >
         <div>
            <h2 class="text-lg font-bold text-gray-900 flex items-center gap-2">
               Pedido #{{ order.orderId }}
               <span
                  class="px-2.5 py-0.5 rounded-full text-xs font-medium border"
                  [ngClass]="{
                     'bg-green-100 text-green-700 border-green-200':
                        order.orderStatus === OrderStatus.COMPLETED,
                     'bg-red-100 text-red-700 border-red-200':
                        order.orderStatus === OrderStatus.CANCELLED,
                     'bg-blue-100 text-blue-700 border-blue-200':
                        order.orderStatus === OrderStatus.CREATED,
                  }"
               >
                  {{
                     order.orderStatus === "CREATED"
                        ? "Pendente"
                        : order.orderStatus === "COMPLETED"
                          ? "Aprovado"
                          : "Cancelado"
                  }}
               </span>
            </h2>
            <p class="text-sm text-gray-500">
               {{ order.createdAt | date: "dd 'de' MMMM 'de' yyyy 'às' HH:mm" }}
            </p>
         </div>
         <button
            (click)="modalClose.emit()"
            class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-200 rounded-full transition-colors"
         >
            <svg
               xmlns="http://www.w3.org/2000/svg"
               fill="none"
               viewBox="0 0 24 24"
               stroke-width="2"
               stroke="currentColor"
               class="w-5 h-5"
            >
               <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M6 18L18 6M6 6l12 12"
               />
            </svg>
         </button>
      </div>

      <div class="p-6 overflow-y-auto flex-1">
         <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-1 space-y-6">
               <div
                  class="bg-white border border-gray-200 rounded-xl p-4 shadow-sm"
               >
                  <h3
                     class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3 flex items-center gap-2"
                  >
                     <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-4 w-4"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                     >
                        <path
                           stroke-linecap="round"
                           stroke-linejoin="round"
                           stroke-width="2"
                           d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                        />
                     </svg>
                     Cliente
                  </h3>
                  <p class="font-medium text-gray-900">
                     {{ order.user.name || "Usuário" }}
                  </p>
                  <p class="text-sm text-gray-500 break-words">
                     {{ order.user.email }}
                  </p>
                  <p class="text-xs text-gray-400 mt-1 font-mono">
                     ID: {{ order.user.id }}
                  </p>
               </div>

               <div
                  class="bg-white border border-gray-200 rounded-xl p-4 shadow-sm"
               >
                  <h3
                     class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3 flex items-center gap-2"
                  >
                     <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-4 w-4"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                     >
                        <path
                           stroke-linecap="round"
                           stroke-linejoin="round"
                           stroke-width="2"
                           d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                        />
                        <path
                           stroke-linecap="round"
                           stroke-linejoin="round"
                           stroke-width="2"
                           d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                        />
                     </svg>
                     Endereço de Entrega
                  </h3>
                  @if (order.user.street) {
                     <p class="text-sm text-gray-800 leading-relaxed">
                        {{ order.user.street }}<br />
                        {{ order.user.city }} - {{ order.user.state }}<br />
                        <span class="text-gray-500">{{ order.user.zip }}</span>
                     </p>
                  } @else {
                     <p class="text-sm text-gray-400 italic">
                        Endereço não informado no cadastro.
                     </p>
                  }
               </div>
            </div>

            <div class="lg:col-span-2">
               <div
                  class="bg-gray-50 rounded-xl border border-gray-200 overflow-hidden"
               >
                  <div
                     class="px-4 py-3 border-b border-gray-200 bg-gray-100/50"
                  >
                     <h3 class="text-sm font-bold text-gray-700">
                        Produtos ({{ order.items.length }})
                     </h3>
                  </div>
                  <div class="divide-y divide-gray-200">
                     @for (item of order.items; track item.itemID) {
                        <div class="flex gap-4 p-4 items-center bg-white">
                           <div
                              class="h-16 w-16 bg-white border border-gray-200 rounded-md overflow-hidden shrink-0"
                           >
                              <img
                                 [src]="item.product.coverImageUrl"
                                 class="w-full h-full object-contain p-1"
                                 alt="{{ item.product.name }}"
                              />
                           </div>

                           <div class="flex-1 min-w-0">
                              <p
                                 class="text-sm font-medium text-gray-900 truncate"
                                 title="{{ item.product.name }}"
                              >
                                 {{ item.product.name }}
                              </p>
                              <p class="text-xs text-gray-500">
                                 {{ item.product.categoryName }}
                              </p>
                              <div class="flex items-center gap-2 mt-1">
                                 <span
                                    class="text-xs bg-gray-100 border border-gray-200 px-2 py-0.5 rounded text-gray-600 font-mono"
                                 >
                                    {{ item.price | currency: "BRL" }} un.
                                 </span>
                                 <span class="text-xs font-medium text-gray-400"
                                    >x {{ item.quantity }}</span
                                 >
                              </div>
                           </div>

                           <div class="text-right">
                              <span class="block font-bold text-gray-900">
                                 {{
                                    item.price * item.quantity | currency: "BRL"
                                 }}
                              </span>
                           </div>
                        </div>
                     }
                  </div>

                  <div
                     class="bg-white p-4 border-t border-gray-200 flex justify-between items-center"
                  >
                     <span class="text-gray-600 font-medium"
                        >Total do Pedido</span
                     >
                     <span class="text-xl font-extrabold text-orange-base">{{
                        calculateTotal() | currency: "BRL"
                     }}</span>
                  </div>
               </div>
            </div>
         </div>
      </div>

      @if (order.orderStatus === OrderStatus.CREATED) {
         <div
            class="px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end gap-3 shrink-0"
         >
            <button
               (click)="reject.emit(order.orderId)"
               class="px-4 py-2 rounded-lg text-sm font-semibold text-red-700 bg-white border border-red-200 hover:bg-red-50 transition-colors shadow-sm"
            >
               Rejeitar Pedido
            </button>
            <button
               (click)="approve.emit(order.orderId)"
               class="px-6 py-2 rounded-lg text-sm font-bold text-white bg-green-600 hover:bg-green-700 shadow-md shadow-green-200 transition-all hover:shadow-lg"
            >
               Aprovar Pedido
            </button>
         </div>
      }
   </div>
</div>
