<div class="flex items-start gap-3 md:gap-4">
   <img
      ngSrc="assets/icons/avatar.svg"
      alt="Avatar do comentador"
      width="40"
      height="40"
      class="rounded-full mt-1 w-10 h-10 object-cover shrink-0"
   />

   <div class="flex-1 min-w-0">
      <div class="bg-slate-100 rounded-xl p-3.5 md:p-4">
         <div class="flex items-start justify-between gap-1">
            <div class="flex flex-wrap items-center gap-x-1 gap-y-0">
               <h4 class="font-bold text-sm text-slate-800">
                  {{ comment.customerName }}
               </h4>
               <div class="flex items-center gap-1">
                  <span class="text-xs text-slate-300">•</span>
                  <p class="text-xs text-slate-500">
                     {{ comment.createdAt | date: "dd/MM/yy" }}
                  </p>
               </div>
            </div>

            @if (isOwner) {
               <div class="relative -mt-1 -mr-1">
                  <button
                     (click)="toggleToolbox()"
                     class="p-2 rounded-full text-slate-500 hover:bg-slate-200 transition-colors focus:bg-slate-200"
                     aria-label="Opções do comentário"
                  >
                     <img
                        ngSrc="assets/icons/dots-vertical.svg"
                        alt="Opções"
                        width="20"
                        height="20"
                     />
                  </button>

                  @if (isToolboxOpen) {
                     <div
                        (click)="$event.stopPropagation()"
                        (keydown.enter)="$event.stopPropagation()"
                        tabindex="0"
                        class="absolute top-full right-0 mt-1 w-40 bg-white border border-slate-100 rounded-lg shadow-xl z-10 overflow-hidden toolbox-animate"
                     >
                        <ul class="py-1">
                           <li>
                              <button
                                 (click)="onEdit()"
                                 class="w-full text-left px-4 py-3 text-sm text-slate-700 hover:bg-slate-50 flex items-center gap-3 active:bg-slate-100"
                              >
                                 <img
                                    ngSrc="assets/icons/edit.svg"
                                    alt="Editar"
                                    width="18"
                                    height="18"
                                 />
                                 <span>Editar</span>
                              </button>
                           </li>
                           <li>
                              <button
                                 (click)="onDelete()"
                                 class="w-full text-left px-4 py-3 text-sm text-red-600 hover:bg-red-50 flex items-center gap-3 active:bg-red-100"
                              >
                                 <img
                                    ngSrc="assets/icons/delete.svg"
                                    alt="Deletar"
                                    width="18"
                                    height="18"
                                 />
                                 <span>Deletar</span>
                              </button>
                           </li>
                        </ul>
                     </div>
                  }
               </div>
            }
         </div>

         <p
            class="text-sm text-slate-700 mt-2 leading-relaxed break-words review-text"
            [class.expanded]="isExpanded"
            appOverflowDetector
            (isOverflowing)="onOverflowChange($event)"
            [innerHTML]="comment.content | mentionHighlighter"
         ></p>

         @if (contentIsOverflowing) {
            <button
               (click)="toggleExpand()"
               class="flex items-center gap-1 mt-2 text-xs font-medium text-blue-600 hover:text-blue-700 active:text-blue-800 focus:outline-none"
            >
               <span>{{ isExpanded ? "Ver menos" : "Ler mais" }}</span>
            </button>
         }
      </div>

      <div class="flex items-center gap-5 mt-3 mb-4 ml-1">
         <button
            (click)="onLike()"
            [class.text-blue-600]="comment.likedByMe"
            [class.font-bold]="comment.likedByMe"
            class="group flex items-center gap-1.5 px-2 py-2 rounded-full hover:bg-slate-100 active:scale-95 transition-all"
            title="Gostei"
         >
            <div class="relative w-[18px] h-[18px]">
               @if (comment.likedByMe) {
                  <img
                     ngSrc="/assets/icons/like-full.svg"
                     alt="Gostei"
                     fill
                     class="object-contain"
                  />
               } @else {
                  <img
                     ngSrc="/assets/icons/like.svg"
                     alt="Gostei"
                     fill
                     class="object-contain opacity-60 group-hover:opacity-100"
                  />
               }
            </div>
            <span class="text-xs md:text-sm font-medium">{{
               comment.likes
            }}</span>
         </button>

         <button
            (click)="onDislike()"
            [class.text-red-600]="comment.dislikedByMe"
            [class.font-bold]="comment.dislikedByMe"
            class="group flex items-center gap-1.5 px-2 py-2 rounded-full hover:bg-slate-100 active:scale-95 transition-all"
            title="Não Gostei"
         >
            <div class="relative w-[18px] h-[18px]">
               @if (comment.dislikedByMe) {
                  <img
                     ngSrc="/assets/icons/dislike-full.svg"
                     alt="Não Gostei"
                     fill
                     class="object-contain"
                  />
               } @else {
                  <img
                     ngSrc="/assets/icons/dislike.svg"
                     alt="Não Gostei"
                     fill
                     class="object-contain opacity-60 group-hover:opacity-100"
                  />
               }
            </div>
            <span class="text-xs md:text-sm font-medium">{{
               comment.dislikes
            }}</span>
         </button>

         <button
            (click)="onReply()"
            class="group flex items-center gap-1.5 px-2 py-2 rounded-full hover:bg-slate-100 active:scale-95 transition-all text-slate-500 hover:text-slate-800"
            title="Responder"
         >
            <div class="relative w-[18px] h-[18px]">
               <img
                  ngSrc="/assets/icons/reply.svg"
                  alt="Responder"
                  fill
                  class="object-contain opacity-60 group-hover:opacity-100"
               />
            </div>
         </button>
      </div>
   </div>
</div>
